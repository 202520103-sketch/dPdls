import streamlit as st

st.set_page_config(page_title="ì˜íƒ€ â†’ í•œê¸€ ë³€í™˜ê¸°", page_icon="ğŸ”¤", layout="centered")

st.title("ì˜íƒ€ â†’ í•œê¸€ ìë™ ë³€í™˜ê¸°")
st.write("ì˜ë¬¸(í‚¤ë³´ë“œ)ë¡œ ì˜ëª» ì¹œ ë¬¸ìì—´ì„ í•œê¸€ ì…ë ¥ì²˜ëŸ¼ ì •í™•í•˜ê²Œ ì¡°í•©í•´ ì¤ë‹ˆë‹¤. (í•œê¸€ 2ë²Œì‹ ê¸°ì¤€)")

# --- í‚¤ë³´ë“œ(ì˜ë¬¸í‚¤) -> ìëª¨ ë§¤í•‘ (ê¸°ë³¸, ëŒ€ë¬¸ìëŠ” ì¼ë¶€ ê²¹ììŒ ì²˜ë¦¬) ---
key2jamo = {
    # consonants (lowercase)
    'r':'ã„±','s':'ã„´','e':'ã„·','f':'ã„¹','a':'ã…','q':'ã…‚','t':'ã……',
    'd':'ã…‡','w':'ã…ˆ','c':'ã…Š','z':'ã…‹','x':'ã…Œ','v':'ã…','g':'ã…',
    # vowels (lowercase)
    'k':'ã…','o':'ã…','i':'ã…‘','j':'ã…“','p':'ã…”','u':'ã…•','h':'ã…—',
    'y':'ã…›','n':'ã…œ','b':'ã… ','m':'ã…¡','l':'ã…£',
    # shifted (uppercase) -> some double consonants
    'R':'ã„²','E':'ã„¸','Q':'ã…ƒ','T':'ã…†','W':'ã…‰',
    # shift vowels: common pairs (O -> ã…’, K? usually same) - include a few
    'O':'ã…’','P':'ã…–'
}

# ì´ˆì„±, ì¤‘ì„±, ì¢…ì„± í‘œì¤€ ëª©ë¡ (ìœ ë‹ˆì½”ë“œ ì¡°í•© ì¸ë±ìŠ¤ìš©)
CHO = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"]
JUNG = ["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"]
JONG = ["", "ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"]

# ê²°í•© ê·œì¹™ (ëª¨ìŒ ê²°í•©, ë³µí•© ë°›ì¹¨ ê²°í•©)
# ëª¨ìŒ ê²°í•©: (base, next) -> combined
VOWEL_COMBINE = {
    ("ã…—","ã…"):"ã…˜", ("ã…—","ã…"):"ã…™", ("ã…—","ã…£"):"ã…š",
    ("ã…œ","ã…“"):"ã…", ("ã…œ","ã…”"):"ã…", ("ã…œ","ã…£"):"ã…Ÿ",
    ("ã…¡","ã…£"):"ã…¢"
}
# ë°›ì¹¨ ê²°í•©: (existing_final, new_consonant) -> combined_final
FINAL_COMBINE = {
    ("ã„±","ã……"):"ã„³", ("ã„´","ã…ˆ"):"ã„µ", ("ã„´","ã…"):"ã„¶",
    ("ã„¹","ã„±"):"ã„º", ("ã„¹","ã…"):"ã„»", ("ã„¹","ã…‚"):"ã„¼",
    ("ã„¹","ã……"):"ã„½", ("ã„¹","ã…Œ"):"ã„¾", ("ã„¹","ã…"):"ã„¿", ("ã„¹","ã…"):"ã…€",
    ("ã…‚","ã……"):"ã…„"
}

# ì˜ë¬¸ í‚¤ ì‹œí€€ìŠ¤ë¥¼ ìëª¨ ì‹œí€€ìŠ¤ë¡œ ë³€í™˜
def keys_to_jamos(s: str):
    jamos = []
    for ch in s:
        if ch in key2jamo:
            jamos.append(key2jamo[ch])
        else:
            # ì˜íƒ€ê°€ ì•„ë‹Œ ë¬¸ì (ê³µë°±, ìˆ«ì, êµ¬ë‘ì  ë“±)ì€ ê·¸ëŒ€ë¡œ í†µê³¼ì‹œí‚¤ê¸° ìœ„í•´ None ë˜ëŠ” ë¬¸ìë¡œ ì²˜ë¦¬
            if ch.isalpha():
                # ì•ŒíŒŒë²³ì´ì§€ë§Œ ë§¤í•‘ì´ ì—†ëŠ” ê²½ìš°(ì˜ˆ: ë‹¤ë¥¸ ë ˆì´ì•„ì›ƒ í‚¤) -> ê·¸ëƒ¥ ë¬¸ìë¡œ ë‘”ë‹¤
                jamos.append(ch)
            else:
                jamos.append(ch)
    return jamos

# ìëª¨ ì‹œí€€ìŠ¤ë¥¼ í•œê¸€ ìŒì ˆë¡œ ì¡°í•©
def jamos_to_hangul(jamos):
    result = []
    L = None  # ì´ˆì„± (ë¬¸ì)
    V = None  # ì¤‘ì„±
    T = None  # ì¢…ì„±

    def flush_syllable():
        nonlocal L, V, T
        if L is None and V is None:
            return ""
        if V is None:
            # ì´ˆì„±ë§Œ ìˆìœ¼ë©´ ì´ˆì„± ê¸€ì(ë‹¨ë… ìëª¨)ë¡œ ì¶œë ¥ (ì™„ì„±í˜•ì´ ì•„ë‹Œ ìëª¨ë¡œ ë‚´ë³´ë‚´ê¸°)
            out = L
        else:
            # ì´ˆì„± ì¸ë±ìŠ¤
            try:
                L_index = CHO.index(L)
            except ValueError:
                # ì´ˆì„± ë¦¬ìŠ¤íŠ¸ì— ì—†ìœ¼ë©´ ã…‡ìœ¼ë¡œ ì·¨ê¸‰
                L_index = CHO.index("ã…‡")
            # ì¤‘ì„± ì¸ë±ìŠ¤
            V_index = JUNG.index(V) if V in JUNG else 0
            # ì¢…ì„± ì¸ë±ìŠ¤
            T_index = JONG.index(T) if (T in JONG) else 0
            code = 0xAC00 + (L_index * 21 + V_index) * 28 + T_index
            out = chr(code)
        L, V, T = None, None, None
        return out

    for j in jamos:
        # ê³µë°±/êµ¬ë‘ì /ìˆ«ì/ë¹„ë§¤í•‘ ë¬¸ìëŠ” í˜„ ìƒíƒœë¥¼ í”ŒëŸ¬ì‹œí•˜ê³  ê·¸ëŒ€ë¡œ ë„£ìŒ
        if not (j in CHO or j in JUNG or j in JONG or j in VOWEL_COMBINE.values() or (len(j)==1 and j.isalpha()==False)):
            # ë§Œì•½ jê°€ í•˜ë‚˜ì˜ ë¡œë§ˆì(alpha)ì²˜ëŸ¼ ë‚¨ì•„ìˆë‹¤ë©´ ê·¸ëƒ¥ flushí•˜ê³  ë„£ìŒ
            if L is not None or V is not None:
                result.append(flush_syllable())
            result.append(j)
            continue

        # ëª¨ìŒì´ë©´
        if j in JUNG:
            if V is None:
                # ê¸°ë³¸ì ìœ¼ë¡œ ì¤‘ì„± ì…‹íŒ…
                if L is None:
                    # ì´ˆì„±ì´ ì—†ìœ¼ë©´ ã…‡ì„ ì´ˆì„±ìœ¼ë¡œ ì‚¬ìš©
                    L = "ã…‡"
                V = j
            else:
                # ì¤‘ì„±ì´ ì´ë¯¸ ìˆìœ¼ë©´ ì´ì¤‘ëª¨ìŒ ê²°í•© ì‹œë„
                comb = VOWEL_COMBINE.get((V, j))
                if comb:
                    V = comb
                else:
                    # ì´ì „ ìŒì ˆì„ ëë‚´ê³  ìƒˆ ìŒì ˆ ì‹œì‘(ì´ˆì„± ã…‡)
                    result.append(flush_syllable())
                    L = "ã…‡"
                    V = j
        # ììŒì´ë©´
        elif j in CHO:
            # ë§Œì•½ ì´ˆì„±ì´ ë¹„ì–´ìˆìœ¼ë©´ ì´ˆì„± ì±„ì›€
            if L is None:
                L = j
            else:
                # ì´ˆì„±ì€ ìˆìœ¼ë‚˜ ì¤‘ì„±ì´ ë¹„ì–´ìˆìœ¼ë©´(ì—°ì† ììŒ) -> ì´ì „ ì´ˆì„± í”ŒëŸ¬ì‹œí•˜ê³  ìƒˆ ì´ˆì„±ìœ¼ë¡œ ì‹œì‘
                if V is None:
                    # ì˜ˆì™¸: ê²¹ì´ˆì„±(ã„± + ã…… ê°™ì´ ê²¹ì´ˆì„±ì€ ë“œë¬¼ê³  í‚¤ë³´ë“œë¡œ ë°”ë¡œ ì…ë ¥ë˜ì§„ ì•ŠëŠ”ë‹¤)
                    # ê°„ë‹¨íˆ ì• ìŒì ˆ í”ŒëŸ¬ì‹œ
                    result.append(flush_syllable())
                    L = j
                else:
                    # ì´ˆì„±ê³¼ ì¤‘ì„±ì´ ìˆìœ¼ë©´ ì´ ììŒì€ ì¢…ì„±ìœ¼ë¡œ ë“¤ì–´ê°ˆ ê°€ëŠ¥ì„±
                    if T is None:
                        T = j
                    else:
                        # ì´ë¯¸ ì¢…ì„±ì´ ìˆìœ¼ë©´ ë³µí•©ì¢…ì„± ê²°í•©ì„ ì‹œë„
                        comb = FINAL_COMBINE.get((T, j))
                        if comb:
                            T = comb
                        else:
                            # ìƒˆ ìŒì ˆ ì‹œì‘: í˜„ì¬ ìŒì ˆì„ í”ŒëŸ¬ì‹œ, ìƒˆ ì´ˆì„±ì€ j
                            result.append(flush_syllable())
                            L = j
    # ë§ˆì§€ë§‰ ë‚¨ì€ ìŒì ˆ í”ŒëŸ¬ì‹œ
    if L is not None or V is not None:
        result.append(flush_syllable())

    return "".join(result)

# ë³€í™˜ ì‹¤í–‰ í•¨ìˆ˜ (ë‹¨ê³„ë³„: í‚¤->ìëª¨->í•œê¸€)
def convert_english_to_korean(s: str):
    jamos = keys_to_jamos(s)
    hangul = jamos_to_hangul(jamos)
    return hangul

# --- Streamlit UI ---
input_text = st.text_area("ì˜íƒ€ ì…ë ¥", value="", height=120)
if st.button("ë³€í™˜"):
    if not input_text:
        st.info("ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
    else:
        converted = convert_english_to_korean(input_text)
        st.success(converted)

# ê°„ë‹¨í•œ ì„¤ëª…
st.markdown("""
**ë©”ëª¨ ë° í•œê³„**
- ì´ ì•±ì€ í‘œì¤€ 2ë²Œì‹ í‚¤ë³´ë“œ ë§¤í•‘ì„ ê¸°ì¤€ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
- ëŒ€ë¬¸ìë¥¼ ì‚¬ìš©í•˜ë©´ ì¼ë¶€ ê²¹ììŒ(ã„², ã„¸, ã…ƒ, ã…†, ã…‰)ì„ ì§€ì›í•©ë‹ˆë‹¤.
- ë“œë¬¼ê²Œ ë³µí•© ëª¨ìŒ/ë³µí•© ë°›ì¹¨ ì¡°í•©ì—ì„œ ì˜ë„ì™€ ë‹¤ë¥´ê²Œ ì²˜ë¦¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ê²½ìš° ì›ë¬¸ê³¼ ê²°ê³¼ë¥¼ ë¶™ì—¬ ë³´ë‚´ì£¼ë©´ ê°œì„ í•˜ê² ìŠµë‹ˆë‹¤. (í™•ì‹¤í•˜ì§€ ì•ŠìŒ)
""")
